<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fish Catch Addition</title>
<style>
  :root{
    /* ÌÅ¨Í≤å Î≥¥Í∏∞ ÏúÑÌïú Í∏∞Î≥∏ Ïä§ÏºÄÏùº ÏóÖ */
    --bg:#eaf7ff;--fg:#0f2233;--border:#b9d9ff;
    --aColor:#2b9cfb;--bColor:#ff6fa8;--ansColor:#6c7a89;
    --fishSize:64px; /* 44 ‚Üí 64 */
    --gap:12px;
    --panelW:1280px; /* 960 ‚Üí 1280 */
    --tankH:200px;   /* 140 ‚Üí 200 */
  }
  *{box-sizing:border-box;}
  body{
    margin:0;background:linear-gradient(#eaf7ff,#d3f1ff 45%,#c5ecff);
    color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Arial,sans-serif;
    display:flex;flex-direction:column;align-items:center;min-height:100vh;
  }
  header{
    width:100%;max-width:var(--panelW);padding:16px 18px;display:flex;gap:12px;flex-wrap:wrap;
    align-items:center;justify-content:space-between;
  }
  h1{margin:0;font-size:26px;font-weight:900;}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
  button,select,label{
    border:1px solid var(--border);background:#fff;color:#0f2233;border-radius:12px;
    padding:12px 16px;font-size:16px;font-weight:700;cursor:pointer;min-height:46px;
  }
  button.primary{background:#0f2233;color:#fff;border-color:#0f2233;}

  main{width:100%;max-width:var(--panelW);padding:10px 18px 24px;display:flex;flex-direction:column;gap:18px;}

  .topbar{
    border:1px solid var(--border);border-radius:12px;padding:12px 14px;background:#fff;
    display:flex;flex-direction:column;gap:10px;
  }
  .status{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
  .pill{padding:8px 12px;border-radius:999px;background:#fff;border:1px solid var(--border);font-weight:800;}
  .pill.mono{font-family:ui-monospace,monospace;}
  .prompt{font-weight:900;font-size:20px;}

  .quiz{
    border:1px solid var(--border);border-radius:16px;background:#ffffffcc;padding:18px;
    display:flex;flex-direction:column;gap:18px;backdrop-filter:saturate(1.2) blur(2px);
  }

  .groups{
    display:grid;
    grid-template-columns:1fr auto 1fr auto 1fr;
    grid-template-rows:auto auto auto;
    gap:14px;
    align-items:center;justify-items:center;
  }
  .numBig{
    font-weight:900;font-size:74px;line-height:1;width:220px;height:126px;text-align:center;
    padding:12px;border-radius:16px;border:3px solid currentColor;background:#fff;
  }
  .numA{color:var(--aColor);} .numB{color:var(--bColor);} .numAns{color:var(--ansColor);}
  .sign{font-size:56px;font-weight:900;padding:4px 8px;}

  /* Ïñ¥Ìï≠(ÌÉ±ÌÅ¨) */
  .aquarium{
    position:relative;height:var(--tankH); width:100%; max-width:520px;
    border-radius:16px; overflow:hidden;
    background:
      radial-gradient(240px 80px at 20% 0%, #ffffffaa 0%, transparent 70%) no-repeat,
      linear-gradient(#b8ecff,#a3e6ff 60%, #93e0ff);
    border:2px solid #9ed8ff; box-shadow:inset 0 0 0 2px #ffffff55;
  }
  .aquarium::after{
    content:"";position:absolute;left:0;right:0;top:0;height:12px;
    background:repeating-linear-gradient(90deg, #ffffffaa 0 12px, #ffffff66 12px 24px);
    opacity:.4;pointer-events:none;
  }
  .label{
    position:absolute;left:12px;top:12px;font-weight:800;font-size:15px;
    background:#ffffffcc;border:1px solid var(--border);padding:6px 10px;border-radius:999px;
  }

  /* Îãµ ÏòÅÏó≠(Í∑∏Î¨º ‚Üí Ïñ¥Ìï≠ ÎäêÎÇåÏúºÎ°ú Î≥ÄÍ≤Ω) */
  .net{
    min-height:var(--tankH); width:100%; max-width:520px; padding:12px;
    display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap;
    border-radius:16px; 
    border:2px solid #9ed8ff;
    background:
      radial-gradient(240px 80px at 20% 0%, #ffffffaa 0%, transparent 70%) no-repeat,
      linear-gradient(#dfe7ee,#eaf3ff 60%, #e1f1ff);
    box-shadow:inset 0 0 0 2px #ffffff55;
    position:relative; overflow:hidden;
  }
  .net::after{
    content:"";position:absolute;left:0;right:0;top:0;height:12px;
    background:repeating-linear-gradient(90deg, #ffffffaa 0 12px, #ffffff66 12px 24px);
    opacity:.35;pointer-events:none;
  }
  .net .label{
    left:auto; right:12px; top:12px;
  }
  .net.dropHint{outline:3px dashed #7b8a97; outline-offset:-6px;}

  /* Î¨ºÍ≥†Í∏∞ */
  .fish{
    position:absolute; width:var(--fishSize); height:var(--fishSize);
    display:flex; align-items:center; justify-content:center;
    font-size:44px; line-height:1; user-select:none; cursor:pointer;
    filter: drop-shadow(0 2px 0 rgba(0,0,0,.08));
    transition:transform .08s ease, opacity .2s ease;
    touch-action:manipulation;
  }
  .fish:active{transform:scale(.92);}
  .fishA{--tint: var(--aColor);}
  .fishB{--tint: var(--bColor);}
  .fish::before{content:"üêü";}
  .tintA::before{filter:hue-rotate(180deg) saturate(1.1);}
  .tintB::before{filter:hue-rotate(320deg) saturate(1.1);}
  .swim{
    animation:
      swimX var(--dur,8s) linear infinite alternate,
      bob 3.6s ease-in-out infinite;
  }
  @keyframes swimX{
    0%  { left: 2%; transform:translateY(0) scaleX(1); }
    49% { transform:translateY(0) scaleX(1); }
    50% { transform:translateY(0) scaleX(-1); }
    100%{ left: calc(100% - var(--fishSize) - 2%); transform:translateY(0) scaleX(-1); }
  }
  @keyframes bob{
    0%,100%{ transform: translateY(-2px); }
    50%{ transform: translateY(3px) }
  }

  /* Ïû°Ìûå Î¨ºÍ≥†Í∏∞Îäî Îçî ÌÅ¨Í≤å */
  .caught{
    position:relative; width:76px; height:76px; font-size:52px;
    animation:none; transform:scale(1) !important;
  }
  .counter{font-weight:800;font-size:16px;color:#244257;}

  .sparkle{position:fixed;width:10px;height:10px;pointer-events:none;border-radius:50%;
    background:radial-gradient(circle,#fff,transparent);animation:sparkle .7s ease-out forwards;}
  @keyframes sparkle{0%{transform:translate(0,0) scale(1);opacity:1;}100%{transform:translate(var(--dx),var(--dy)) scale(0.2);opacity:0;}}

  footer{padding:16px;color:#244257;font-size:14px;text-align:center;}

  /* Î∞òÏùëÌòï: ÏûëÏùÄ Í∏∞Í∏∞ÏóêÏÑúÎäî ÏÇ¥Ïßù Ï∂ïÏÜå */
  @media (max-width: 768px){
    :root{ --panelW: 100vw; --fishSize:56px; --tankH:170px; }
    .numBig{ font-size:56px; width:180px; height:110px; }
    .sign{ font-size:44px; }
  }
</style>
</head>
<body>
<header>
  <h1>üé£ Fish Catch Addition</h1>
  <div class="controls">
    <label for="levelSel">Level:</label>
    <select id="levelSel">
      <option value="1" selected>1 (sum ‚â§ 10)</option>
      <option value="2">2 (sum ‚â• 10)</option>
    </select>
    <label for="rangeSel">Max:</label>
    <select id="rangeSel">
      <option value="5">5</option>
      <option value="10" selected>10</option>
      <option value="20">20</option>
    </select>
    <button id="make10Btn">Make 10</button>
    <button id="newBtn">üé≤ New Problem</button>
    <button id="voiceBtn" class="primary">üó£Ô∏è Voice On</button>
  </div>
</header>

<main>
  <div class="topbar">
    <div class="status">
      <span class="pill" id="modePill">Mode: Fish</span>
      <span class="pill">Target: <strong id="targetLabel">‚Äî</strong></span>
      <span class="pill mono" id="eqPill">0 + 0 = ?</span>
    </div>
    <span class="prompt">Tap a fish to catch it in the net!</span>
  </div>

  <div class="quiz">
    <div class="groups">
      <div id="numA" class="numBig numA">0</div>
      <div class="sign">+</div>
      <div id="numB" class="numBig numB">0</div>
      <div class="sign">=</div>
      <div id="answerNum" class="numBig numAns">?</div>

      <div id="tankA" class="aquarium">
        <span class="label">Pond A</span>
      </div>
      <div></div>
      <div id="tankB" class="aquarium">
        <span class="label">Pond B</span>
      </div>
      <div></div>
      <div id="net" class="net dropHint" aria-label="Answer Net">
        <span class="label">Answer Tank</span>
      </div>

      <div id="countA" class="counter">A: 0 fish</div>
      <div></div>
      <div id="countB" class="counter">B: 0 fish</div>
      <div></div>
      <div id="countAns" class="counter">Fish in net: 0</div>
    </div>
  </div>
</main>

<footer>Catching fish makes addition visual and fun!</footer>

<script>
(()=> {
const numAEl=document.getElementById('numA'),
      numBEl=document.getElementById('numB'),
      answerNum=document.getElementById('answerNum'),
      tankA=document.getElementById('tankA'),
      tankB=document.getElementById('tankB'),
      net=document.getElementById('net'),
      newBtn=document.getElementById('newBtn'),
      make10Btn=document.getElementById('make10Btn'),
      rangeSel=document.getElementById('rangeSel'),
      levelSel=document.getElementById('levelSel'),
      eqPill=document.getElementById('eqPill'),
      targetLabel=document.getElementById('targetLabel'),
      voiceBtn=document.getElementById('voiceBtn'),
      countA=document.getElementById('countA'),
      countB=document.getElementById('countB'),
      countAns=document.getElementById('countAns');

let audioCtx=null;
function ensureAudio(){if(!audioCtx){const AC=window.AudioContext||window.webkitAudioContext;audioCtx=AC?new AC():null;}}
function winSound(){ensureAudio();if(!audioCtx)return;
  const notes=[523,659,784,1046],now=audioCtx.currentTime;
  notes.forEach((f,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type='triangle';o.frequency.value=f;
    const t=now+i*0.09;g.gain.setValueAtTime(0.0001,t);
    g.gain.exponentialRampToValueAtTime(0.25,t+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.08);
    o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.12);
  });
}

let voiceOn=true,voiceEN=null;
function pickEnVoice(){
  const list=window.speechSynthesis?window.speechSynthesis.getVoices():[];
  if(!list||!list.length)return null;
  return list.find(v=>/^en(-|_)?US/i.test(v.lang))||list.find(v=>/^en/i.test(v.lang))||null;
}
function prepareVoices(){
  voiceEN=pickEnVoice();
  if(!voiceEN&&window.speechSynthesis){
    window.speechSynthesis.addEventListener('voiceschanged',()=>{voiceEN=pickEnVoice();},{once:true});
  }
}
function speakQuestion(a,b){
  if(!voiceOn||!window.speechSynthesis)return;
  const u=new SpeechSynthesisUtterance(`${a} plus ${b}. Catch the fish and move them to the tank.`);
  u.lang='en-US';if(voiceEN)u.voice=voiceEN;
  try{window.speechSynthesis.cancel();}catch(e){}
  window.speechSynthesis.speak(u);
}

let maxN=10,make10=false,level=1,A=0,B=0,S=0;

function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function rand(min,max){return Math.random()*(max-min)+min;}

function buildFish(tank,n,origin){
  tank.querySelectorAll('.fish').forEach(f=>f.remove());
  const cap=Math.max(0,Math.min(30,n)); /* ÏµúÎåÄÏπò ÏÇ¥Ïßù ÏÉÅÌñ• */
  for(let i=0;i<cap;i++){
    const d=document.createElement('div');
    d.className=`fish swim ${origin==='A'?'fishA tintA':'fishB tintB'}`;
    d.dataset.origin=origin;
    d.dataset.in=origin;
    d.tabIndex=0;
    d.style.top = `${rand(12, 86)}%`;
    d.style.setProperty('--dur', `${rand(6, 12).toFixed(1)}s`);
    d.style.animationDelay = `${(-1*rand(0,6)).toFixed(2)}s`;
    d.addEventListener('click',()=>toggleMove(d));
    tank.appendChild(d);
  }
}

function newProblem(){
  if(make10){
    const t=10;S=t;A=randInt(0,t);B=t-A;targetLabel.textContent='10';
  }else{
    if(level===1){S=randInt(0,Math.min(10,maxN));}
    else{S=randInt(10,Math.min(20,maxN));}
    A=randInt(0,S);B=S-A;
    targetLabel.textContent=`${A}+${B}`;
  }
  numAEl.textContent=A;numBEl.textContent=B;answerNum.textContent='?';
  eqPill.textContent=`${A}+${B}=?`;
  buildFish(tankA,A,'A');
  buildFish(tankB,B,'B');
  net.innerHTML='<span class="label">Answer Tank</span>'; /* ÎùºÎ≤® Ïú†ÏßÄ */
  updateCounters();
  speakQuestion(A,B);
}

function toggleMove(node){
  const inNet = node.parentElement===net;
  if(inNet){
    const origin=node.dataset.origin==='A'?tankA:tankB;
    node.classList.remove('caught'); node.classList.add('swim');
    origin.appendChild(node);
    node.dataset.in=node.dataset.origin;
    node.style.top = `${rand(12,86)}%`;
    node.style.setProperty('--dur', `${rand(6,12).toFixed(1)}s`);
  }else{
    node.classList.remove('swim'); node.classList.add('caught');
    node.style.top = ''; node.style.left = '';
    net.appendChild(node);
    node.dataset.in='NET';
  }
  updateCounters();
  checkSolved();
}

function countFishIn(el){return el.querySelectorAll('.fish').length;}
function updateCounters(){
  countA.textContent=`A: ${countFishIn(tankA)} fish`;
  countB.textContent=`B: ${countFishIn(tankB)} fish`;
  const c=countFishIn(net);
  countAns.textContent=`Fish in net: ${c}`;
  answerNum.textContent=c===0?'?':c;
}

let solved=false, solveTimer=null;
function checkSolved(){
  const c=countFishIn(net);
  if(c===A+B){
    if(!solved){
      solved=true;
      celebrate();
      /* ‚úÖ Ï†ïÎãµ ÌõÑ 3Ï¥à ÎåÄÍ∏∞ ÌõÑ Îã§Ïùå Î¨∏Ï†ú */
      clearTimeout(solveTimer);
      solveTimer = setTimeout(()=>{solved=false; newProblem();}, 3000);
    }
  }else{
    solved=false;
    clearTimeout(solveTimer);
  }
}
function celebrate(){
  winSound();
  eqPill.textContent=`${A}+${B}=${A+B}`;
  const r=answerNum.getBoundingClientRect();
  for(let i=0;i<14;i++){
    const s=document.createElement('div');s.className='sparkle';
    const ang=Math.random()*Math.PI*2,dist=50+Math.random()*50;
    s.style.left=`${r.left+r.width/2}px`;s.style.top=`${r.top+r.height/2}px`;
    s.style.setProperty('--dx',`${Math.cos(ang)*dist}px`);
    s.style.setProperty('--dy',`${Math.sin(ang)*dist}px`);
    document.body.appendChild(s);setTimeout(()=>s.remove(),700);
  }
}

newBtn.addEventListener('click',newProblem);
make10Btn.addEventListener('click',()=>{make10=!make10;make10Btn.classList.toggle('primary',make10);newProblem();});
rangeSel.addEventListener('change',()=>{maxN=parseInt(rangeSel.value,10);newProblem();});
levelSel.addEventListener('change',()=>{level=parseInt(levelSel.value,10);newProblem();});
voiceBtn.addEventListener('click',()=>{
  voiceOn=!voiceOn;
  voiceBtn.textContent=voiceOn?'üó£Ô∏è Voice On':'ü§ê Voice Off';
  if(!voiceOn&&window.speechSynthesis){try{window.speechSynthesis.cancel();}catch(e){}}
});
document.addEventListener('click',function once(){ensureAudio();if(window.speechSynthesis){prepareVoices();}document.removeEventListener('click',once);});
newProblem();
})();
</script>
</body>
</html>
