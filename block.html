<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Block Addition Game</title>
<style>
  :root{
    --bg:#fafafa;--fg:#111;--border:#d9d9d9;
    --aColor:#4da6ff;--bColor:#ff77b4;--ansColor:#6c7a89;
    --block:36px;--gap:8px;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Arial,sans-serif;
    display:flex;flex-direction:column;align-items:center;
    min-height:100vh;
  }
  header{
    width:100%;max-width:960px;padding:14px 16px;
    display:flex;gap:10px;flex-wrap:wrap;
    align-items:center;justify-content:space-between;
  }
  h1{margin:0;font-size:22px;font-weight:900;}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
  button,select,label{
    border:1px solid var(--border);
    background:#fff;
    color:#111;
    border-radius:12px;
    padding:10px 14px;
    font-size:15px;
    font-weight:700;
    cursor:pointer;
    min-height:44px;
  }
  button.primary{background:#111;color:#fff;border-color:#111;}

  main{
    width:100%;max-width:960px;padding:8px 16px 20px;
    display:flex;flex-direction:column;gap:16px;
  }

  .topbar{
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 12px;
    background:#fff;
    display:flex;flex-direction:column;gap:8px;
  }
  .status{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
  .pill{padding:6px 10px;border-radius:999px;background:#fff;border:1px solid var(--border);font-weight:800;}
  .pill.mono{font-family:ui-monospace,monospace;}
  .prompt{font-weight:900;font-size:18px;}

  .quiz{
    border:1px solid var(--border);
    border-radius:12px;
    background:#fff;
    padding:16px;
    display:flex;flex-direction:column;gap:16px;
  }

  .groups{
    display:grid;
    grid-template-columns:1fr auto 1fr auto 1fr;
    grid-template-rows:auto auto auto;
    gap:10px 12px;
    align-items:center;
    justify-items:center;
  }
  .numBig{
    font-weight:900;
    font-size:64px;
    line-height:1;
    width:180px;height:110px;
    text-align:center;
    padding:10px;
    border-radius:16px;
    border:3px solid currentColor;
    background:#fff;
  }
  .numA{color:var(--aColor);}
  .numB{color:var(--bColor);}
  .numAns{color:var(--ansColor);}
  .sign{font-size:48px;font-weight:900;padding:4px 8px;}

  .numBlocks{
    display:grid;
    grid-template-columns:repeat(5, var(--block));
    grid-auto-rows:var(--block);
    gap:var(--gap);
    justify-content:center;
    max-width:calc(5*var(--block) + 4*var(--gap) + 12px);
    min-height:calc(var(--block) + var(--gap));
    padding:10px;
    border:2px dashed transparent;
    border-radius:14px;
    transition:border-color .15s, background .15s;
    touch-action:manipulation;
  }
  .numBlocks.dropHint{border-color:rgba(0,0,0,.15);background:#fafafa;}
  .nb{
    width:var(--block);height:var(--block);
    border-radius:10px;border:1px solid rgba(0,0,0,.07);
    background:currentColor;opacity:.25;
    cursor:pointer;transition:transform .06s ease;
  }
  .nb:active{transform:scale(.96);}
  .blocksA{color:var(--aColor);}
  .blocksB{color:var(--bColor);}
  .blocksAns{color:var(--ansColor);}
  .counter{font-weight:800;font-size:15px;color:#555;}
  .sparkle{position:fixed;width:10px;height:10px;pointer-events:none;border-radius:50%;
    background:radial-gradient(circle,#fff,transparent);animation:sparkle .7s ease-out forwards;}
  @keyframes sparkle{0%{transform:translate(0,0) scale(1);opacity:1;}100%{transform:translate(var(--dx),var(--dy)) scale(0.2);opacity:0;}}
  footer{padding:14px;color:#666;font-size:14px;text-align:center;}
</style>
</head>
<body>
<header>
  <h1>üß± Block Addition</h1>
  <div class="controls">
    <label for="levelSel">Level:</label>
    <select id="levelSel">
      <option value="1" selected>1 (sum ‚â§ 10)</option>
      <option value="2">2 (sum ‚â• 10)</option>
    </select>
    <label for="rangeSel">Max:</label>
    <select id="rangeSel">
      <option value="5">5</option>
      <option value="10" selected>10</option>
      <option value="20">20</option>
    </select>
    <button id="make10Btn">Make 10</button>
    <button id="newBtn">üé≤ New Problem</button>
    <button id="voiceBtn" class="primary">üó£Ô∏è Voice On</button>
  </div>
</header>

<main>
  <div class="topbar">
    <div class="status">
      <span class="pill" id="modePill">Mode: Blocks</span>
      <span class="pill">Target: <strong id="targetLabel">‚Äî</strong></span>
      <span class="pill mono" id="eqPill">0 + 0 = ?</span>
    </div>
    <span class="prompt">Tap or click blocks to move them into the answer box!</span>
  </div>

  <div class="quiz">
    <div class="groups">
      <div id="numA" class="numBig numA">0</div>
      <div class="sign">+</div>
      <div id="numB" class="numBig numB">0</div>
      <div class="sign">=</div>
      <div id="answerNum" class="numBig numAns">?</div>

      <div id="blocksA" class="numBlocks blocksA"></div>
      <div></div>
      <div id="blocksB" class="numBlocks blocksB"></div>
      <div></div>
      <div id="ansBlocks" class="numBlocks blocksAns dropHint" aria-label="Answer Area"></div>

      <div id="countA" class="counter">A: 0 blocks</div>
      <div></div>
      <div id="countB" class="counter">B: 0 blocks</div>
      <div></div>
      <div id="countAns" class="counter">Answer box: 0 blocks</div>
    </div>
  </div>
</main>

<footer>Move the blocks to learn addition visually!</footer>

<script>
(()=> {
const numAEl=document.getElementById('numA'),
      numBEl=document.getElementById('numB'),
      answerNum=document.getElementById('answerNum'),
      blocksA=document.getElementById('blocksA'),
      blocksB=document.getElementById('blocksB'),
      ansBlocks=document.getElementById('ansBlocks'),
      newBtn=document.getElementById('newBtn'),
      make10Btn=document.getElementById('make10Btn'),
      rangeSel=document.getElementById('rangeSel'),
      levelSel=document.getElementById('levelSel'),
      eqPill=document.getElementById('eqPill'),
      targetLabel=document.getElementById('targetLabel'),
      voiceBtn=document.getElementById('voiceBtn'),
      countA=document.getElementById('countA'),
      countB=document.getElementById('countB'),
      countAns=document.getElementById('countAns');

let audioCtx=null;
function ensureAudio(){if(!audioCtx){const AC=window.AudioContext||window.webkitAudioContext;audioCtx=AC?new AC():null;}}
function winSound(){ensureAudio();if(!audioCtx)return;
  const notes=[523,659,784,1046],now=audioCtx.currentTime;
  notes.forEach((f,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type='triangle';o.frequency.value=f;
    const t=now+i*0.09;g.gain.setValueAtTime(0.0001,t);
    g.gain.exponentialRampToValueAtTime(0.25,t+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.08);
    o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.12);
  });
}

let voiceOn=true,voiceEN=null;
function pickEnVoice(){
  const list=window.speechSynthesis?window.speechSynthesis.getVoices():[];
  if(!list||!list.length)return null;
  return list.find(v=>/^en(-|_)?US/i.test(v.lang))||list.find(v=>/^en/i.test(v.lang))||null;
}
function prepareVoices(){
  voiceEN=pickEnVoice();
  if(!voiceEN&&window.speechSynthesis){
    window.speechSynthesis.addEventListener('voiceschanged',()=>{voiceEN=pickEnVoice();},{once:true});
  }
}
function speakQuestion(a,b){
  if(!voiceOn||!window.speechSynthesis)return;
  const u=new SpeechSynthesisUtterance(`${a} plus ${b}. Move the blocks into the answer box.`);
  u.lang='en-US';if(voiceEN)u.voice=voiceEN;
  try{window.speechSynthesis.cancel();}catch(e){}
  window.speechSynthesis.speak(u);
}

let maxN=10,make10=false,level=1,A=0,B=0,S=0;

function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function buildBlocks(el,n,origin){
  el.innerHTML='';
  const cap=Math.max(0,Math.min(20,n));
  for(let i=0;i<cap;i++){
    const d=document.createElement('div');
    d.className='nb';
    d.dataset.origin=origin;
    d.dataset.in=origin;
    d.tabIndex=0;
    d.addEventListener('click',()=>toggleMove(d));
    el.appendChild(d);
  }
}
function newProblem(){
  if(make10){
    const t=10;S=t;A=randInt(0,t);B=t-A;targetLabel.textContent='10';
  }else{
    if(level===1){S=randInt(0,Math.min(10,maxN));}
    else{S=randInt(10,Math.min(20,maxN));}
    A=randInt(0,S);B=S-A;
    targetLabel.textContent=`${A}+${B}`;
  }
  numAEl.textContent=A;numBEl.textContent=B;answerNum.textContent='?';
  eqPill.textContent=`${A}+${B}=?`;
  buildBlocks(blocksA,A,'A');
  buildBlocks(blocksB,B,'B');
  ansBlocks.innerHTML='';
  updateCounters();
  speakQuestion(A,B);
}
function toggleMove(node){
  const inAns=node.parentElement===ansBlocks;
  if(inAns){
    const origin=node.dataset.origin==='A'?blocksA:blocksB;
    origin.appendChild(node);
    node.dataset.in=node.dataset.origin;
  }else{
    ansBlocks.appendChild(node);
    node.dataset.in='ANS';
  }
  updateCounters();
  checkSolved();
}
function countChildren(el){return el.children.length;}
function updateCounters(){
  countA.textContent=`A: ${countChildren(blocksA)} blocks`;
  countB.textContent=`B: ${countChildren(blocksB)} blocks`;
  const c=countChildren(ansBlocks);
  countAns.textContent=`Answer box: ${c} blocks`;
  answerNum.textContent=c===0?'?':c;
}
let solved=false;
function checkSolved(){
  const c=countChildren(ansBlocks);
  if(c===A+B){
    if(!solved){solved=true;celebrate();setTimeout(()=>{solved=false;newProblem();},900);}
  }else{solved=false;}
}
function celebrate(){
  winSound();
  eqPill.textContent=`${A}+${B}=${A+B}`;
  const r=answerNum.getBoundingClientRect();
  for(let i=0;i<12;i++){
    const s=document.createElement('div');s.className='sparkle';
    const ang=Math.random()*Math.PI*2,dist=40+Math.random()*40;
    s.style.left=`${r.left+r.width/2}px`;s.style.top=`${r.top+r.height/2}px`;
    s.style.setProperty('--dx',`${Math.cos(ang)*dist}px`);
    s.style.setProperty('--dy',`${Math.sin(ang)*dist}px`);
    document.body.appendChild(s);setTimeout(()=>s.remove(),700);
  }
}

newBtn.addEventListener('click',newProblem);
make10Btn.addEventListener('click',()=>{make10=!make10;make10Btn.classList.toggle('primary',make10);newProblem();});
rangeSel.addEventListener('change',()=>{maxN=parseInt(rangeSel.value,10);newProblem();});
levelSel.addEventListener('change',()=>{level=parseInt(levelSel.value,10);newProblem();});
voiceBtn.addEventListener('click',()=>{
  voiceOn=!voiceOn;
  voiceBtn.textContent=voiceOn?'üó£Ô∏è Voice On':'ü§ê Voice Off';
  if(!voiceOn&&window.speechSynthesis){try{window.speechSynthesis.cancel();}catch(e){}}
});
document.addEventListener('click',function once(){ensureAudio();if(window.speechSynthesis){prepareVoices();}document.removeEventListener('click',once);});
newProblem();
})();
</script>
</body>
</html>
